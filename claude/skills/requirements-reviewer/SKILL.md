---
name: requirements-reviewer
description: >
  要求定義書（機能要求）を理論的観点からレビューするスキル。
  CSP安定失敗モデルに基づき、活性（liveness）・到達可能性（reachability）・安全性（safety）の
  3性質の網羅性・明確性・分離性を評価し、構造化されたフィードバックを出力する。
  要求定義のレビュー、要求の品質チェック、要求仕様の妥当性確認を行う際に使用する。
disable-model-invocation: true
---

# Requirements Reviewer

## 概要

要求定義書を「CSP安定失敗モデル」「Michael Jacksonの要求理論」「Meyer's Design by Contract」に基づく理論的枠組みでレビューする。

各要求を**活性（liveness）・到達可能性（reachability）・安全性（safety）・非機能要求**に分類し、各チェック観点で品質を評価して構造化されたフィードバックを出力する。

> 詳細な理論的背景は `references/theory.md` を参照。

---

## レビューワークフロー

### Step 1: 要求定義書を読み込む

ユーザーから要求定義書（またはその抜粋）を受け取る。
複数の要求が箇条書きや番号付きリストで記載されている場合、それぞれを個別の要求として扱う。

### Step 2: 各要求を分類する

各要求を以下の5カテゴリのいずれかに分類する。

| カテゴリ | 定義 | 判別のヒント |
|---------|------|------------|
| **活性** | いつかいいことが起こる | 「～すると、いつか～が起こる」形式 |
| **到達可能性** | 特定の状態・動作が可能 | 「～できる」「～な状態に到達できる」形式 |
| **安全性** | 悪いことが決して起こらない | 「～は発生しない」「～後に～は起きない」形式 |
| **非機能** | 量的指標でしか記述できない性質 | 時間・負荷・使用性の数値基準 |
| **分類不能** | 複数性質が混在、または曖昧 | 分類基準に当てはまらない |

### Step 3: 各チェック観点で評価する

各観点について「OK」または「NG（指摘事項あり）」を判定する。

#### (1) 非機能要求の分離

量的指標は非機能要求として独立して記述されているか確認する。
- 「Xmsec以内に」「N回以下の操作で」等の量的制約が機能要求に埋め込まれていないか
- 「なるべく」「素早く」「正確に」等の曖昧な修飾語が非機能要求の未記述の代替になっていないか

#### (2) 過剰仕様の回避

要求が仕様の領域（未言及トレースの定義・具体的な実装手段の指定）に踏み込んでいないか確認する。
- UI部品・操作順序・エラー表示方法などを要求段階で固定していないか
- 機能要求の時点では「言及されていないトレースは未定義」であるべき

#### (3) テスト導出可能性

各要求から受理トレース・拒否トレースの両方を導出できるか確認する。
- 活性要求: 「条件Cが満たされたとき、イベントWが起こるトレース」を受理テストとして書けるか
- 安全性要求: 「禁止された振る舞いを試みるトレース」を拒否テストとして書けるか
- テストに変換できない曖昧な要求はないか

#### (4) 活性と到達可能性のペアリング

活性要求に対応する到達可能性要求があるか確認する。
- 「XするといつかYが起こる」という活性要求があれば、「Xが起こせる状態に到達できる」という到達可能性要求も必要
- 到達可能性のない活性要求は「起こりえない前提条件」で常に満たせてしまい、実質的に意味をなさない

#### (5) 曖昧な表現の検出

測定・検証が困難な曖昧語がないか確認する。

曖昧語の例: 「適切に」「正しく」「十分に」「なるべく」「素早く」「うまく」「きちんと」「可能な限り」「一般的に」

---

## 出力フォーマット

レビュー結果は以下のテンプレートで出力する。

```markdown
## 要求定義レビュー結果

### 要求の分類

| # | 要求 | 分類 | 備考 |
|---|------|------|------|
| 1 | （要求の要約） | 活性 / 到達可能性 / 安全性 / 非機能 / 分類不能 | （補足） |
| 2 | ... | ... | ... |

### チェック結果

| # | チェック観点 | 結果 | 指摘事項 |
|---|-------------|------|----------|
| 1 | 非機能要求の分離 | OK / NG | （NGの場合：該当する要求） |
| 2 | 過剰仕様の回避 | OK / NG | （NGの場合：仕様に踏み込んでいる箇所） |
| 3 | テスト導出可能性 | OK / NG | （NGの場合：テストに変換できない要求） |
| 4 | 活性と到達可能性のペアリング | OK / NG | （NGの場合：ペアのない活性要求） |
| 5 | 曖昧な表現の検出 | OK / NG | （NGの場合：曖昧語を含む要求） |

### 改善提案

1. （具体的な改善案を番号付きで列挙）
2. ...
```

---

## 参考: 理論的背景

詳細な理論的枠組みは `references/theory.md` に記載されている。以下の内容を参照できる:

- 3性質の定義と判別基準（判別チャートを含む）
- 非機能要求の定義と量的指標への変換
- 成果物の階層と詳細化の関係（機能要求→仕様→設計→実装→テストケース）
- トレース集合・失敗集合の概念
- 自販機の具体例（良い要求・悪い要求）
- 要求 vs 仕様の境界（過剰仕様の例を含む）
