# Attack Tree 構築パターン

Attack Tree（攻撃木）は、システムへの攻撃経路を階層的に視覚化・分析する手法です。

## Attack Tree の基本概念

### 構造
```
目標（Root）
├── サブ目標1（AND/OR）
│   ├── 攻撃手法1-1
│   └── 攻撃手法1-2
└── サブ目標2（AND/OR）
    ├── 攻撃手法2-1
    └── 攻撃手法2-2
```

### ノードタイプ
- **AND**: すべての子ノードが成功する必要がある
- **OR**: いずれかの子ノードが成功すれば良い

### 属性
- **Cost（コスト）**: 攻撃の実行コスト（Low/Medium/High）
- **Difficulty（難易度）**: 攻撃の実行難易度（Low/Medium/High）
- **Detection（検出可能性）**: 攻撃が検出される確率（Low/Medium/High）
- **Success（成功率）**: 攻撃の成功確率（Low/Medium/High）

## パターン1: 不正アクセス

```
目標: システムに不正アクセス
├── OR: 認証を突破
│   ├── AND: ブルートフォース攻撃
│   │   ├── 弱いパスワードポリシー
│   │   └── レート制限なし
│   ├── クレデンシャルスタッフィング
│   ├── AND: フィッシング攻撃
│   │   ├── フィッシングメール送信
│   │   └── ユーザーが認証情報を入力
│   └── セッションハイジャック
└── OR: 認証をバイパス
    ├── SQLインジェクション
    ├── 認証ロジックの脆弱性
    └── デフォルト認証情報
```

### 主要攻撃の属性
- **ブルートフォース**: Cost=Low, Difficulty=Low, Detection=High, Success=Medium
- **SQLインジェクション**: Cost=Low, Difficulty=Medium, Detection=Medium, Success=High
- **フィッシング**: Cost=Low, Difficulty=Low, Detection=Low, Success=Medium

## パターン2: データ漏洩

```
目標: 機密データの窃取
├── OR: データベースから取得
│   ├── AND: SQLインジェクション
│   │   ├── 入力検証の欠如
│   │   └── パラメータ化クエリ未使用
│   ├── AND: データベース直接アクセス
│   │   ├── 露出したデータベースポート
│   │   └── 弱い認証情報
│   └── バックアップファイルの取得
├── OR: APIから取得
│   ├── AND: IDOR（Insecure Direct Object Reference）
│   │   ├── 認可チェック不足
│   │   └── 予測可能なID
│   ├── 過剰な情報返却
│   └── AND: APIキー漏洩
│       ├── ソースコードにハードコード
│       └── GitHubに公開
└── OR: ファイルシステムから取得
    ├── パストラバーサル
    ├── 不適切なファイル権限
    └── バックアップファイルの露出
```

### 対策マッピング
- **SQLインジェクション**: パラメータ化クエリ、入力検証、WAF
- **IDOR**: 認可チェック、UUID使用、アクセス制御リスト
- **パストラバーサル**: パス正規化、ホワイトリスト検証、chroot jail

## パターン3: サービス妨害（DoS）

```
目標: サービスを停止させる
├── OR: リソース枯渇
│   ├── AND: アプリケーション層DoS
│   │   ├── レート制限なし
│   │   └── 大量リクエスト送信
│   ├── AND: CPU枯渇攻撃
│   │   ├── 計算量の多い処理
│   │   └── タイムアウトなし
│   └── AND: メモリ枯渇攻撃
│       ├── 大容量ファイルアップロード
│       └── ファイルサイズ制限なし
├── OR: ネットワーク層DoS
│   ├── DDoS攻撃
│   ├── SYN Flood
│   └── UDP Flood
└── OR: ロジック層DoS
    ├── 無限ループを引き起こす入力
    ├── 正規表現DoS（ReDoS）
    └── XML Bomb
```

### 主要攻撃のリスク評価
- **DDoS**: Impact=Critical, Likelihood=Medium, Detection=High
- **ReDoS**: Impact=High, Likelihood=Low, Detection=Medium

## パターン4: 権限昇格

```
目標: 管理者権限を取得
├── OR: 垂直権限昇格
│   ├── AND: SQLインジェクションで権限変更
│   │   ├── SQLインジェクション脆弱性
│   │   └── UPDATE権限あり
│   ├── AND: APIの認可チェック不足
│   │   ├── /admin/*エンドポイント
│   │   └── ログインのみチェック
│   └── パストラバーサルで設定ファイル変更
└── OR: 水平権限昇格
    ├── AND: IDOR経由
    │   ├── 他ユーザーのIDを推測
    │   └── 認可チェックなし
    └── セッションハイジャック
```

## パターン5: データ改ざん

```
目標: データを不正に変更
├── OR: データベース改ざん
│   ├── SQLインジェクション
│   ├── NoSQLインジェクション
│   └── 直接データベースアクセス
├── OR: ファイル改ざん
│   ├── パストラバーサル
│   ├── 不適切なファイル権限
│   └── AND: アップロード経由
│       ├── ファイルタイプ検証なし
│       └── 実行権限あり
└── OR: メモリ改ざん
    ├── バッファオーバーフロー
    └── Use-After-Free
```

## パターン6: サプライチェーン攻撃

```
目標: サプライチェーン経由で侵害
├── OR: 依存関係の侵害
│   ├── AND: 悪意のあるパッケージ
│   │   ├── タイポスクワッティング
│   │   └── パッケージ名の類似性
│   ├── 既知の脆弱性のあるバージョン
│   └── 依存関係の侵害（間接依存）
├── OR: ビルドプロセスの侵害
│   ├── AND: CI/CDパイプライン侵害
│   │   ├── 認証情報の漏洩
│   │   └── パイプライン設定の改ざん
│   └── ビルドサーバーの侵害
└── OR: 開発環境の侵害
    ├── 開発者マシンの侵害
    └── AND: ソースコードリポジトリ侵害
        ├── Git認証情報の漏洩
        └── コードの改ざん
```

### サプライチェーン対策
- **依存関係管理**: SBOMの作成、定期的な脆弱性スキャン、依存関係のロック、信頼できるレジストリのみ使用
- **CI/CDセキュリティ**: シークレット管理、Pipeline as Code、ビルド成果物の署名、最小権限でのジョブ実行

## Attack Tree 分析テンプレート

```markdown
# 攻撃木分析: [システム名]

## 目標
[攻撃者の最終目標]

## 攻撃経路

### 経路1: [経路名]
**タイプ:** AND/OR
**ステップ:**
1. [ステップ1]
2. [ステップ2]

**属性:**
- コスト: Low/Medium/High
- 難易度: Low/Medium/High
- 検出可能性: Low/Medium/High
- 成功率: Low/Medium/High

**対策:**
- [対策1]
- [対策2]

**リスク評価:**
- 影響度: Critical/High/Medium/Low
- 発生可能性: High/Medium/Low
- リスクレベル: Critical/High/Medium/Low

---

## リスク優先度

| 経路 | リスクレベル | 優先度 | 対策コスト |
|------|------------|-------|----------|
| 経路1 | Critical | 1 | Medium |
| 経路2 | High | 2 | Low |
```
