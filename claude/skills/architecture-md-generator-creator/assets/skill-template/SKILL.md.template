---
name: architecture-md-generator
description: ARCHITECTURE.mdを生成。コードベースを分析してシステム構成図、外部依存、コードマップを自動作成。「ARCHITECTURE.mdを生成」「アーキテクチャドキュメントを作成」で使用。
---

# Architecture Md Generator

このスキルは、プロジェクトのコードベースを分析し、包括的な`ARCHITECTURE.md`ドキュメントを自動生成します。

## 生成されるドキュメント構造

```markdown
# Architecture

## Overview
[プロジェクトの概要、主要な技術スタック]

## System Diagram
[Mermaid形式のシステム構成図]

## External Services
[システム構成に含まれる外部サービス]

## Code Map
### Directory Structure
```

## ワークフロー

### Step 1: プロジェクト分析

プロジェクトの基本情報を収集します:

**分析対象:**
1. **プログラミング言語の検出**
   - ファイル拡張子の統計（.js, .py, .go, .rs, .java, etc.）
   - 設定ファイルの確認

2. **フレームワーク/ライブラリの特定**
   - package.json (Node.js/JavaScript)
   - requirements.txt, pyproject.toml (Python)
   - go.mod (Go)
   - Cargo.toml (Rust)
   - pom.xml, build.gradle (Java)
   - Gemfile (Ruby)

3. **プロジェクトタイプの判定**
   - Webアプリケーション
   - CLIツール
   - ライブラリ/SDK
   - マイクロサービス
   - モバイルアプリ

**実行方法:**
```bash
# ディレクトリ構造の確認
ls -la

# 依存関係ファイルの検索
find . -name "package.json" -o -name "requirements.txt" -o -name "go.mod" -o -name "Cargo.toml" -o -name "pom.xml" -o -name "build.gradle" -o -name "Gemfile"

# ファイルタイプの統計
find . -type f | grep -E '\.(js|ts|py|go|rs|java|rb)$' | sed 's/.*\.//' | sort | uniq -c | sort -rn
```

### Step 2: 外部サービスの抽出

コード内で使用している外部API/サービスを検出します:

**検出方法:**
- 環境変数ファイル (.env, .env.example) の確認
- 設定ファイル内のAPI URLパターン検索
- コード内の外部サービスクライアント検出（AWS SDK, Stripe, etc.）

**検索パターン:**
```bash
# 環境変数ファイルの検索
grep -E '(API_KEY|API_URL|SERVICE_URL|DATABASE_URL)' .env.example 2>/dev/null

# AWSサービスの使用検出
grep -r "aws-sdk" --include="*.json" --include="*.js" --include="*.py"

# 一般的なサービスの検出
grep -r -E "(stripe|twilio|sendgrid|cloudinary|firebase)" --include="package.json" --include="requirements.txt"
```

**出力形式:**
```markdown
## External Services

- **AWS S3** - File storage
- **Stripe** - Payment processing
- **SendGrid** - Email delivery
```

### Step 3: システム構成図の生成

Mermaid形式でシステムアーキテクチャを視覚化します:

#### 構成図タイプの選択

**1. Webアプリケーション（フロントエンド + バックエンド）:**
```mermaid
graph TB
    Client[Client Browser]
    Frontend[Frontend App<br/>React/Vue/Angular]
    Backend[Backend API<br/>Express/Django/Spring]
    DB[(Database<br/>PostgreSQL/MySQL)]
    Cache[(Cache<br/>Redis)]
    Storage[Object Storage<br/>S3/GCS]

    Client -->|HTTPS| Frontend
    Frontend -->|API Requests| Backend
    Backend -->|Query| DB
    Backend -->|Cache| Cache
    Backend -->|Upload/Download| Storage
```

**2. マイクロサービス:**
```mermaid
graph TB
    Gateway[API Gateway]
    Auth[Auth Service]
    User[User Service]
    Order[Order Service]
    DB1[(User DB)]
    DB2[(Order DB)]
    Queue[Message Queue<br/>RabbitMQ/Kafka]

    Gateway --> Auth
    Gateway --> User
    Gateway --> Order
    User --> DB1
    Order --> DB2
    Order --> Queue
    User --> Queue
```

**3. CLIツール/ライブラリ:**
```mermaid
graph LR
    User[User]
    CLI[CLI Tool]
    API[External API]
    FS[(File System)]

    User -->|Commands| CLI
    CLI -->|HTTP| API
    CLI -->|Read/Write| FS
```

#### 構成図生成の手順

1. **エントリーポイントの特定**
   - `index.html`, `main.js`, `app.py`, `main.go` など

2. **主要レイヤーの識別**
   - Presentation層（UI/Controllers）
   - Business Logic層（Services）
   - Data Access層（Repositories/Models）

3. **外部接続の追加**
   - データベース
   - キャッシュ
   - 外部API
   - ストレージ

4. **データフローの記述**
   - リクエストの流れ
   - データの永続化
   - 非同期処理

**Mermaid構文のベストプラクティス:**
- `graph TB` (Top to Bottom) または `graph LR` (Left to Right) を用途に応じて選択
- ノード形状: `[]`（長方形）、`()`（丸角）、`[()]`（円柱・DB用）
- 矢印ラベル: `-->|Label|` で関係性を明示
- 複数行テキスト: `<br/>` で改行

### Step 4: コードマップの作成

プロジェクトの構造を文書化します:

#### Directory Structure（ディレクトリ構造）

**生成方法:**
```bash
# 主要ディレクトリのツリー表示
tree -d --charset ascii

# treeコマンドがない場合
find . -type d | grep -v node_modules | grep -v .git | sort
```

**出力形式:**
```markdown
### Directory Structure

\`\`\`
src/
├── components/       # React components
├── services/         # Business logic
├── models/           # Data models
├── utils/            # Utility functions
└── config/           # Configuration files
tests/
├── unit/             # Unit tests
└── integration/      # Integration tests
docs/                 # Documentation
\`\`\`
```

**全階層の各ディレクトリの役割を記述:**
- 簡潔な説明（1行）
- 主要な責務

### Step 5: ARCHITECTURE.md出力

収集した情報を統合してドキュメントを生成します:

#### 完全な出力テンプレート

```markdown
# Architecture

## Overview

[プロジェクト名] is a [プロジェクトタイプ] built with [主要技術スタック].

**Tech Stack:**
- **Language:** [言語とバージョン]
- **Framework:** [フレームワーク]
- **Database:** [データベース]
- **Infrastructure:** [デプロイ環境]

**Project Type:** [Webアプリ/API/CLI/ライブラリ]

## System Diagram

\`\`\`mermaid
[ここにMermaid構成図を挿入]
\`\`\`

## External Services

[Step 2で検出した外部サービス]

## Code Map

### Directory Structure

[Step 4で生成したディレクトリ構造]

---

*This document was auto-generated by the Architecture Generator skill.*
*Last updated: [生成日時]*
```

#### 出力先の決定

デフォルト: プロジェクトルートに `ARCHITECTURE.md`

**確認事項:**
1. 既存のARCHITECTURE.mdがある場合は上書き確認
2. 出力先のカスタマイズオプションを提供

**最終出力:**
```bash
# ARCHITECTURE.mdを作成
# (上記テンプレートに収集した情報を埋め込む)
```

## 実行時のチェックリスト

実行前に以下を確認してください:

- [ ] プロジェクトルートで実行しているか
- [ ] 依存関係ファイル（package.json等）が存在するか
- [ ] .gitignoreでnode_modules等が除外されているか
- [ ] 書き込み権限があるか

## カスタマイズポイント

生成されるドキュメントは以下の要素でカスタマイズ可能:

1. **構成図のスタイル**: プロジェクトタイプに応じて最適な図を選択
2. **詳細レベル**: 依存関係の詳細度を調整
3. **追加セクション**: 特定のプロジェクトで必要なセクションを追加
   - Performance Considerations
   - Security Architecture
   - Deployment Strategy

## 参考資料

詳細なガイドラインは `references/architecture-guide.md` を参照してください:
- Overviewセクションのベストプラクティス
- Mermaid構成図のパターン集
- 外部依存の分類基準
- コードマップの構造例
