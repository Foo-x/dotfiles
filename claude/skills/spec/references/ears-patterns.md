# EARS記法 詳細パターンガイド

このドキュメントでは、各EARSパターンの詳細テンプレート、良い例・悪い例、使い分けのポイントを説明します。

---

## 1. Ubiquitous（ユビキタス要件）

### 構文
```
システムは[動作]すること
```

### 用途
- 常に満たすべき基本要件
- システム全体に適用される制約
- 前提条件なしで常に真であるべき事項

### 良い例 ✅
- システムはUTF-8でデータを保存すること
- システムはHTTPS通信を使用すること
- システムは全ての入力値をサニタイズすること
- システムはログを日時付きで記録すること

### 悪い例 ❌
- システムは適切に動作すること（曖昧）
- システムは速く応答すること（検証不可能）
- システムはユーザーフレンドリーであること（主観的）
- システムはデータを保存し、ログを記録し、エラーを処理すること（複数の責務）

### ポイント
- 「常に」「全ての」といった普遍性を意識
- 条件やトリガーがない基本的な振る舞い
- 検証可能な具体的表現を使う

---

## 2. Event-driven（イベント駆動要件）

### 構文
```
WHEN [イベント], システムは[動作]すること
```

### 用途
- 特定のイベント発生時の動作
- ユーザー操作への応答
- 外部システムからの通知処理

### 良い例 ✅
- WHENユーザーがログインボタンを押下した時、システムは認証画面を表示すること
- WHENファイルアップロードが完了した時、システムは完了通知を送信すること
- WHENエラーが発生した時、システムはエラーログを記録すること
- WHEN 5分間操作がない時、システムは自動ログアウトすること

### 悪い例 ❌
- WHENユーザーがログイン中の時、システムはダッシュボードを表示すること（継続状態なのでWHILEが適切）
- WHENボタンを押した時、システムはデータを保存し、メールを送信し、画面を更新すること（複数の動作は分割）
- WHENエラーの時（イベントが不明確）

### ポイント
- 一時的・瞬間的なイベント
- ユーザー操作、タイムアウト、外部API呼び出しなど
- イベントの内容を具体的に記述

---

## 3. State-driven（状態駆動要件）

### 構文
```
WHILE [状態], システムは[動作]すること
```

### 用途
- 特定の状態が継続している間の動作
- 条件が満たされている間の振る舞い
- 継続的な監視や表示

### 良い例 ✅
- WHILEファイルアップロード中、システムは進捗バーを表示すること
- WHILEログイン中、システムはセッションを維持すること
- WHILE接続が確立している間、システムはハートビートを送信すること
- WHILEバッテリー残量が20%未満の間、システムは省電力モードで動作すること

### 悪い例 ❌
- WHILEボタンを押した時（一時的イベントなのでWHENが適切）
- WHILEログイン中、システムはログイン画面を表示すること（論理矛盾）
- WHILE処理中（状態が不明確）

### ポイント
- 継続的な状態（ログイン中、接続中、処理中など）
- 状態が続く限り継続する動作
- WHEN（イベント）との違いを意識

### WHEN vs WHILE の判別チェックリスト

| 質問 | WHEN | WHILE |
|------|------|-------|
| トリガーは瞬間的か継続的か？ | 瞬間的 | 継続的 |
| 「〜した時」と表現できるか？ | できる | できない |
| 「〜している間」と表現できるか？ | できない | できる |
| 例 | ボタン押下、メッセージ受信 | ログイン中、接続中 |

---

## 4. Optional（オプション要件）

### 構文
```
WHERE [条件], システムは[動作]すること
```

### 用途
- 特定条件下でのみ有効な機能
- 権限や設定に依存する機能
- オプション機能の有効/無効

### 良い例 ✅
- WHERE管理者権限がある場合、システムは削除ボタンを表示すること
- WHEREダークモードが有効な場合、システムは黒背景で表示すること
- WHERE通知設定がONの場合、システムはプッシュ通知を送信すること
- WHEREデバッグモードが有効な場合、システムは詳細ログを出力すること

### 悪い例 ❌
- WHERE適切な権限がある場合（曖昧）
- WHEREエラーが発生した場合（エラー処理はIFが適切）
- WHEREユーザーがログインした場合（イベントなのでWHENが適切）

### ポイント
- 機能の有効/無効を条件で切り替え
- 権限、設定、フィーチャーフラグなど
- IFとの違い：WHEREは機能の存在、IFは異常系

---

## 5. Unwanted（望ましくない状態への対応）

### 構文
```
IF [条件], THEN システムは[動作]すること
```

### 用途
- エラー処理
- 例外対応
- バリデーションエラー
- 異常系シナリオ

### 良い例 ✅
- IFパスワードが誤っている場合、THENシステムはエラーメッセージを表示すること
- IFネットワーク接続が失敗した場合、THENシステムはリトライを3回実行すること
- IFファイルサイズが10MBを超える場合、THENシステムはアップロードを拒否すること
- IF同時ログイン数が上限に達した場合、THENシステムは待機メッセージを表示すること

### 悪い例 ❌
- IFログインが成功した場合（正常系はWHENが適切）
- IFエラーが発生した場合、THENシステムは適切に処理すること（曖昧）
- IF入力が無効な場合（具体的な条件を記述）

### ポイント
- 「望ましくない」状態への対応
- エラー、バリデーション失敗、リソース不足など
- WHERE（オプション機能）との違いを意識

### WHERE vs IF の判別チェックリスト

| 質問 | WHERE | IF |
|------|-------|-----|
| 機能の有効/無効か？ | Yes | No |
| エラー・異常系か？ | No | Yes |
| 正常な選択肢の一つか？ | Yes | No |
| 例 | 権限、設定、機能フラグ | エラー、バリデーション失敗 |

---

## 6. Complex（複合要件）

### 構文
```
[複数のパターンを組み合わせ]
```

### 用途
- 複数の条件が組み合わさる要件
- 複雑なビジネスロジック
- ネストした条件

### 良い例 ✅
- WHILE接続中、WHENデータ受信時、システムは即座に画面を更新すること
- WHERE管理者権限がある場合、WHENユーザー削除ボタンを押下した時、システムは確認ダイアログを表示すること
- WHILEファイルアップロード中、IFネットワークエラーが発生した場合、THENシステムはアップロードを一時停止し、リトライボタンを表示すること

### 悪い例 ❌
- WHILE接続中、かつログイン中、かつ管理者で、WHENボタンを押した時、システムは...（複雑すぎる。分割すべき）

### ポイント
- 2つまでの組み合わせが望ましい
- 3つ以上の条件は分割を検討
- 可読性を優先

---

## 要件作成チェックリスト

要件を書いた後、以下をチェックしてください：

### ✅ 明確性
- [ ] 1つの解釈しかできないか？
- [ ] 実装者が迷わないか？
- [ ] 曖昧な表現（適切に、十分に、なるべく）を使っていないか？

### ✅ 検証可能性
- [ ] テストで確認できるか？
- [ ] 合格/不合格の判定基準が明確か？
- [ ] 定量的な基準があるか？（必要な場合）

### ✅ 簡潔性
- [ ] 1つの要件に1つの責務か？
- [ ] 複数の動作が混在していないか？
- [ ] 分割できる部分はないか？

### ✅ 一貫性
- [ ] 他の要件と矛盾していないか？
- [ ] 用語の使い方は統一されているか？
- [ ] 全体として整合性があるか？

### ✅ 必要性
- [ ] この要件が満たすべき価値は何か？
- [ ] ユーザーにとっての利益は明確か？
- [ ] 重複する要件はないか？

---

## パターン選択フローチャート

```
質問: この要件には条件やトリガーがあるか？
 ├─ NO → Ubiquitous
 └─ YES
      ├─ イベント発生時の動作か？ → Event-driven (WHEN)
      ├─ 継続的な状態での動作か？ → State-driven (WHILE)
      ├─ オプション機能か？ → Optional (WHERE)
      ├─ エラー・異常系か？ → Unwanted (IF...THEN)
      └─ 複数の条件が組み合わさるか？ → Complex
```

---

## まとめ

| パターン | キーワード | 使用場面 | 典型例 |
|---------|-----------|---------|-------|
| Ubiquitous | なし | 常に満たすべき基本要件 | データ保存形式、通信プロトコル |
| Event-driven | WHEN | イベント発生時 | ボタン押下、タイムアウト |
| State-driven | WHILE | 継続的な状態 | ログイン中、接続中 |
| Optional | WHERE | 条件付き機能 | 権限、設定、フィーチャーフラグ |
| Unwanted | IF...THEN | エラー・異常系 | バリデーションエラー、接続失敗 |
| Complex | 組み合わせ | 複雑な条件 | 状態+イベント、権限+操作 |
