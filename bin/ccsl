#!/usr/bin/env bash

input=$(cat)

model=$(echo "${input}" | jq -r '.model.display_name')
dir=$(echo "${input}" | jq -r '.workspace.current_dir')

blocks=$(bunx ccusage blocks -O)
remaining=$(echo "${blocks}" | grep -oP ', \K(.+ remaining)')
percent=$(echo "${blocks}" | grep -oP 'ACTIVE.+?\K([.\d]+%)')

if [ -n "$remaining" ]; then
  echo "ğŸ¤– ${model} | ğŸ“ ${dir/${HOME}/\~} | â³ ${percent} (${remaining})"
else
  echo "ğŸ¤– ${model} | ğŸ“ ${dir/${HOME}/\~}"
fi

# vim:ft=sh
